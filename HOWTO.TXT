Install Windows XP SP3 via RIS from Linux
=========================================

Requirements:

- ris-linux package, for needed tools and patches and the BINL server
- atftpd (or tftpd-hpa, but that's chrooted so no outside symlinks) + case-insensitive patch (from ris-linux)
- udhcpd (or other dhcp server) configured for bootp
- samba configured to share the I386 directory of winxp
- a winxp iso to get drivers and files needed for installation
- LAN drivers from driverpacks.net (+p7zip archiver), or windows drivers from the winxp iso, or both
- binl server from ris-linux + driver database built by a script from ris-linux

Preparation:

- patch atftpd to be case-insensitive (patch from ris-linux; on Debian run patch-atftpd)
- choose a dir for tftp files, edit /etc/default/atftpd for it, and fix the tftproot symlink to point to it!
- dump your winxp cd to a iso file and fix the winxp.iso symlink to point to it so that mount-winxpcd can work!
- warning: make any file you put in the tftproot dir read-only to atftpd's user and group, including the dir itself!!!
- extract pxe and boot files from winxp iso to the tftproot dir and patch ntldr: run extract-boot-files and patch-ntldr
- get and extract lan drivers and inf files from driverspack.net: run get-lan-drivers and extract-lan-drivers
- alternatively, extract drivers and inf files from winxp cd: run extract-winxp-drivers
- now is the time to add more ethernet drivers: inf files go to the inf dir, sys files and the rest to the drivers dir
- build drivers database from extracted inf files: run build-drivers-database
- config dhcpd for bootp: you need to tell it the ip of the tftp server and the boot file which is "startrom.n12"
- if you use pxelinux instead, copy or symlink startrom.n12 to startrom.0 and just add "kernel startrom.0" to your pxelinux menu entry
- copy the I386 dir from winxp cd to tftproot/winxp/I386
- pour the contents of the drivers dir over tftproot/winxp/I386
- tweak winnt.sif.sample and put it in tftproot/winnt.sif
- config samba to share the tftproot/winxp dir as the "reminst" share (see smb.conf.sample)
- change BASEPATH in rislinux/binlsrv.py to point to tftproot/winxp/i386; you can also make it point
  to the ../drivers dir, it's the same thing as binlsrv only looks for the driver files.
- alternatively, you may want to build and use the mini-binl server (eg. binlsrv.py didn't find
  my RTL GigE driver): run build-mini-binlsrv

Installation:

- server: start samba, dhcpd, atftpd, and binlsrv (or mini-binlsrv).
- to start/stop binlsrv/mini-binlsrv use the included binlsrv (or mini-binlsrv) start/stop script.
- client: config client's bios for netbooting and reboot.

Notes:

As you can see, the preparation process is mostly captured in scripts. Just run (and possibly edit
to configure) the scripts in whatever order. The scripts call dependent scripts automatically and they
don't do the same thing twice. So in case of error, you have to remove the effects of the script
in order to run it again, eg. you have to remove the drivers dir manually to be able to extract
the drivers again.

References:

http://www.promodus.net/linuxris/
http://wiki.themel.com/XPNetInstall
http://echo.wordpress.com/2010/03/01/installing-windows-xp-from-network-ris/
http://diddy.boot-land.net/pxe/files/binl.htm
http://diddy.boot-land.net/pxe/files/ris_files.htm
http://diddy.boot-land.net/pxe/files/winnt_sif.htm
http://driverpacks.net/
http://oss.netfarm.it/guides/
    http://oss.netfarm.it/guides/ris-linux.pdf
    http://oss.netfarm.it/guides/ris-linux.php
    http://oss.netfarm.it/guides/pxe.php
http://paradice.forumotion.com/t3-winntsif-lists-nearly-all-possible-settings-for-unattended

------------------------------------------------------
Cosmin Apreutesei (c)2011, MIT license for my own work

